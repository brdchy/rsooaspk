# Настройка интеграции с VK

## Работа без токена

Система **не требует** получения VK Access Token и работает через публичный API и парсинг HTML страницы группы.

### Как это работает

1. **Публичный API** - система пытается использовать публичный endpoint VK API для получения постов
2. **Парсинг HTML** - если публичный API недоступен, система парсит HTML страницу группы VK

Оба метода работают для публичных групп без необходимости авторизации.

## Использование

### Миграция существующих постов

Импортировать все существующие посты из группы VK:

```bash
npm run vk:migrate
```

Или с ограничением количества:

```bash
tsx scripts/migrate-vk-posts.ts --limit=50
```

**Пример вывода:**
```
Начинаем миграцию постов из VK (без токена)...
Найдено 25 постов
✓ Импортирован пост 12345: Заголовок поста...
...

=== Результаты миграции ===
Импортировано: 25
Пропущено: 0
Ошибок: 0
Всего обработано: 25
```

### Автоматическая синхронизация (демон)

Запустить демона для периодической проверки новых постов:

```bash
npm run vk:sync
```

С настройкой интервала (в миллисекундах, по умолчанию 1 час = 3600000):

```bash
tsx scripts/vk-sync-daemon.ts --interval=1800000
```

**Пример вывода:**
```
Демон синхронизации VK запущен (без токена)
Интервал проверки: 60 минут
Нажмите Ctrl+C для остановки

[2025-12-25T12:00:00.000Z] Проверка новых постов...
  ✓ Импортирован новый пост 12346: Новый заголовок...
  Импортировано новых постов: 1
```

### Ручная синхронизация

В админ-панели на странице `/admin/news` есть кнопка "Синхронизировать с VK" для ручной проверки новых постов.

Также можно использовать API endpoint:

```bash
POST /api/admin/vk/sync
```

## Ограничения

- **Публичные группы**: Работает только с публичными группами VK
- **Rate limiting**: При парсинге HTML рекомендуется использовать задержки между запросами
- **Структура данных**: Парсинг HTML может быть менее надежным, чем API, но работает для большинства случаев
- **Изображения**: При парсинге HTML изображения могут быть недоступны (зависит от структуры страницы)

## Примечания

- ID группы: `225463959` (используется автоматически)
- Система автоматически пропускает уже импортированные посты
- Текст очищается от форматирования VK (упоминания, ссылки)
- Для каждого поста создается уникальный slug и сохраняется ссылка на оригинал в VK

## Альтернатива с токеном (опционально)

Если вы хотите использовать официальный VK API с токеном для более надежной работы, см. инструкции в старой версии файла. Однако для большинства случаев это не требуется.
